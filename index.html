<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oodi CRM</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script type="module" src="app.js"></script>
</head>
<body>
  <div id="mainApp" style="display: none;">
    <header class="app-header">
      <h1>Oodi CRM</h1>
      <div class="user-info">
        <span id="userEmail"></span>
        <button class="btn logout-btn" onclick="logoutUser()">
          <i class="fas fa-sign-out-alt"></i> Chiqish
        </button>
      </div>
    </header>

    <main>
      <section id="dashboardSection" class="page">
        <div class="page-header">
          <h2>Bosh sahifa</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <i class="fas fa-user-graduate stat-icon"></i>
            <h3 id="studentsCount">0</h3>
            <p>O'quvchilar</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-calendar-check stat-icon"></i>
            <h3 id="attendanceCount">0</h3>
            <p>Bugun keldi</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-money-bill-wave stat-icon"></i>
            <h3 id="totalPayments">0 so'm</h3>
            <p>Umumiy to'lovlar</p>
          </div>
        </div>
        <div class="quick-actions">
          <button class="btn primary-btn" onclick="showPage('studentsPage')">
            <i class="fas fa-plus"></i> O'quvchi qo'shish
          </button>
          <button class="btn primary-btn" onclick="showPage('attendancePage')">
            <i class="fas fa-calendar-check"></i> Davomat
          </button>
          <button class="btn primary-btn" onclick="showAddPaymentModal()">
            <i class="fas fa-plus"></i> To'lov qo'shish
          </button>
        </div>
      </section>

      <section id="studentsPage" class="page" style="display: none;">
        <div class="page-header">
          <h2>O'quvchilar</h2>
          <button class="btn primary-btn" onclick="showAddStudentForm()">
            <i class="fas fa-plus"></i> Qo'shish
          </button>
        </div>
        <div id="addStudentForm" class="form-container" style="display: none;">
          <h3>Yangi o'quvchi qo'shish</h3>
          <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="studentName" placeholder="O'quvchi ismi">
          </div>
          <div class="input-group">
            <i class="fas fa-phone"></i>
            <input type="tel" id="studentPhone" placeholder="Telefon raqami">
          </div>
          <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="studentEmail" placeholder="Elektron pochta">
          </div>
          <div class="form-actions">
            <button class="btn secondary-btn" onclick="showAddStudentForm()">Bekor qilish</button>
            <button class="btn primary-btn" onclick="addStudent()">
              <i class="fas fa-save"></i> Saqlash
            </button>
          </div>
        </div>
        <div id="studentsList"></div>
      </section>

      <section id="attendancePage" class="page" style="display: none;">
        <div class="page-header">
          <h2>Davomat</h2>
          <div class="input-group">
            <i class="far fa-calendar-alt"></i>
            <input type="date" id="attendanceDate">
          </div>
          <button class="btn primary-btn" onclick="exportAttendanceReport('pdf')">
            <i class="fas fa-file-pdf"></i> PDF
          </button>
          <button class="btn primary-btn" onclick="exportAttendanceReport('excel')">
            <i class="fas fa-file-excel"></i> Excel
          </button>
        </div>
        <div class="page-actions">
          <button class="btn primary-btn" onclick="markAllPresent()">
            <i class="fas fa-check"></i> Hamma keldi
          </button>
        </div>
        <div id="attendanceList"></div>
      </section>

      <section id="paymentsPage" class="page" style="display: none;">
        <div class="page-header">
          <h2>To'lovlar</h2>
          <button class="btn primary-btn" onclick="showAddPaymentModal()">
            <i class="fas fa-plus"></i> To'lov qo'shish
          </button>
          <button class="btn primary-btn" onclick="exportPaymentsReport('pdf')">
            <i class="fas fa-file-pdf"></i> PDF
          </button>
          <button class="btn primary-btn" onclick="exportPaymentsReport('excel')">
            <i class="fas fa-file-excel"></i> Excel
          </button>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <i class="fas fa-money-bill-wave stat-icon"></i>
            <h3 id="totalPayments">0 so'm</h3>
            <p>Umumiy to'lovlar</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-check-circle stat-icon"></i>
            <h3 id="paidCount">0</h3>
            <p>To'langan</p>
          </div>
          <div class="stat-card">
            <i class="fas fa-hourglass-half stat-icon"></i>
            <h3 id="pendingCount">0</h3>
            <p>Kutilmoqda</p>
          </div>
        </div>
        <div class="filters">
          <div class="input-group">
            <i class="fas fa-search"></i>
            <input type="text" id="paymentSearch" placeholder="Qidirish..." oninput="filterPayments()">
          </div>
          <select id="paymentMonth" onchange="loadPayments()">
            <option value="">Barcha oylar</option>
            <option value="01">Yanvar</option>
            <option value="02">Fevral</option>
            <option value="03">Mart</option>
            <option value="04">Aprel</option>
            <option value="05">May</option>
            <option value="06">Iyun</option>
            <option value="07">Iyul</option>
            <option value="08">Avgust</option>
            <option value="09">Sentabr</option>
            <option value="10">Oktabr</option>
            <option value="11">Noyabr</option>
            <option value="12">Dekabr</option>
          </select>
        </div>
        <div id="paymentsList"></div>
      </section>
    </main>

    <nav class="bottom-nav">
      <div class="nav-item active" onclick="showPage('dashboardSection')">
        <i class="fas fa-home"></i>
        <span>Bosh sahifa</span>
      </div>
      <div class="nav-item" onclick="showPage('studentsPage')">
        <i class="fas fa-user-graduate"></i>
        <span>O'quvchilar</span>
      </div>
      <div class="nav-item" onclick="showPage('attendancePage')">
        <i class="fas fa-calendar-check"></i>
        <span>Davomat</span>
      </div>
      <div class="nav-item" onclick="showPage('paymentsPage')">
        <i class="fas fa-money-bill-wave"></i>
        <span>To'lovlar</span>
      </div>
    </nav>

    <div id="paymentModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>To'lov qo'shish</h3>
          <span class="modal-close" onclick="closeModal('paymentModal')">×</span>
        </div>
        <form id="paymentForm" onsubmit="addPayment(event)">
          <div class="input-group">
            <label for="paymentStudent">O'quvchi</label>
            <select id="paymentStudent">
              <option value="">O'quvchini tanlang</option>
            </select>
          </div>
          <div class="input-group">
            <label for="paymentAmount">To'lov miqdori</label>
            <input type="number" id="paymentAmount" placeholder="Miqdor (so'm)">
          </div>
          <div class="input-group">
            <label for="paymentDate">Sana</label>
            <input type="date" id="paymentDate">
          </div>
          <div class="input-group">
            <label for="paymentType">To'lov turi</label>
            <select id="paymentType">
              <option value="naqd">Naqd</option>
              <option value="karta">Karta</option>
              <option value="bank">Bank</option>
              <option value="click">Click</option>
              <option value="payme">Payme</option>
            </select>
          </div>
          <div class="input-group">
            <label for="paymentComment">Izoh</label>
            <input type="text" id="paymentComment" placeholder="Izoh (ixtiyoriy)">
          </div>
          <div class="form-actions">
            <button type="button" class="btn secondary-btn" onclick="closeModal('paymentModal')">Bekor qilish</button>
            <button type="submit" class="btn primary-btn">
              <i class="fas fa-save"></i> Saqlash
            </button>
          </div>
        </form>
      </div>
    </div>

    <div id="confirmModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Tasdiqlash</h3>
          <span class="modal-close" onclick="closeModal('confirmModal')">×</span>
        </div>
        <p>Haqiqatan ham ushbu to'lovni o'chirmoqchimisiz?</p>
        <div class="form-actions">
          <button class="btn secondary-btn" onclick="closeModal('confirmModal')">Bekor qilish</button>
          <button id="confirmDeleteBtn" class="btn danger-btn">
            <i class="fas fa-trash"></i> O'chirish
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="authSection" class="auth-section">
    <div class="auth-container">
      <h2 class="auth-title">Kirish</h2>
      <div id="loginSection">
        <div class="input-group">
          <i class="fas fa-envelope"></i>
          <input type="email" id="emailInput" placeholder="Elektron pochta">
        </div>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="passwordInput" placeholder="Parol">
        </div>
        <button class="btn primary-btn" type="submit" onclick="loginUser()">
          <i class="fas fa-sign-in-alt"></i> Kirish
        </button>
        <p class="auth-switch">
          Akkauntingiz yo'qmi? 
          <a href="#" onclick="showRegisterForm()">Ro'yxatdan o'tish</a>
        </p>
      </div>
      <div id="registerSection" style="display: none;">
        <div class="input-group">
          <i class="fas fa-envelope"></i>
          <input type="email" id="registerEmail" placeholder="Elektron pochta">
        </div>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="registerPassword" placeholder="Parol">
        </div>
        <div class="input-group">
          <i class="fas fa-lock"></i>
          <input type="password" id="confirmPassword" placeholder="Parolni tasdiqlash">
        </div>
        <button class="btn primary-btn" onclick="registerUser()">
          <i class="fas fa-user-plus"></i> Ro'yxatdan o'tish
        </button>
        <p class="auth-switch">
          Akkauntingiz bormi? 
          <a href="#" onclick="showLoginForm()">Kirish</a>
        </p>
      </div>
    </div>
  </div>

  <div id="toastContainer" class="toast-container"></div>
</body>
</html>